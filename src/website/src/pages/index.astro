---
import { getEntry } from 'astro:content';
import MainLayout from '../layouts/MainLayout.astro';

// Section components
import Hero from '../components/sections/Hero.astro';
import ProblemStatement from '../components/sections/ProblemStatement.astro';
import Services from '../components/sections/Services.astro';
import Process from '../components/sections/Process.astro';
import Testimonials from '../components/sections/Testimonials.astro';
import Expertise from '../components/sections/Expertise.astro';
import About from '../components/sections/About.astro';
import Faq from '../components/sections/Faq.astro';
import Cta from '../components/sections/Cta.astro';
import Footer from '../components/sections/Footer.astro';

// Get the landing page data from the content collection
// This is populated by the LandingPageGenerationService when it runs
const profile = await getEntry('landingPage', 'profile');

const { 
  title, 
  description, 
  name, 
  tagline,
  sectionOrder = [],
  hero,
  problemStatement,
  services,
  process,
  testimonials,
  expertise,
  about,
  faq,
  cta,
  footer
} = profile.data;

// Create a map of section names to determine which sections should be rendered
const sectionsToRender = {
  hero: !!hero,
  problemStatement: problemStatement?.enabled,
  services: !!services,
  process: process?.enabled,
  testimonials: testimonials?.enabled,
  expertise: expertise?.enabled,
  about: about?.enabled,
  faq: faq?.enabled,
  cta: cta?.enabled,
  footer: footer?.enabled
};

// Font Awesome for icons
const useFontAwesome = 
  (footer?.contactDetails?.social && footer.contactDetails.social.length > 0) || 
  (services?.items.some(item => item.icon));

// Meta title should use the landing page title if available
const metaTitle = title || `${name} - ${tagline}`;
const metaDescription = description || `Professional website for ${name} - ${tagline}`;
---

<MainLayout title={metaTitle} description={metaDescription}>
  <!-- Load Font Awesome if needed -->
  {useFontAwesome && (
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  )}
  
  <!-- Render sections according to sectionOrder -->
  {sectionOrder.map(section => {
    switch(section) {
      case 'hero':
        return sectionsToRender.hero && <Hero hero={hero} />;
      case 'problemStatement':
        return sectionsToRender.problemStatement && <ProblemStatement problemStatement={problemStatement} />;
      case 'services':
        return sectionsToRender.services && <Services services={services} />;
      case 'process':
        return sectionsToRender.process && <Process process={process} />;
      case 'testimonials':
        return sectionsToRender.testimonials && <Testimonials testimonials={testimonials} />;
      case 'expertise':
        return sectionsToRender.expertise && <Expertise expertise={expertise} />;
      case 'about':
        return sectionsToRender.about && <About about={about} />;
      case 'faq':
        return sectionsToRender.faq && <Faq faq={faq} />;
      case 'cta':
        return sectionsToRender.cta && <Cta cta={cta} />;
      case 'footer':
        return sectionsToRender.footer && <Footer footer={footer} />;
      default:
        return null;
    }
  })}
</MainLayout>